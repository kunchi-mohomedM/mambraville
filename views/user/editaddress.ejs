<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Edit Address | MambraVille</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 min-h-screen">

    <header class="bg-white shadow-sm">
        <%- include("../../views/partials/user/header") %>
    </header>

    <div class="max-w-lg mx-auto bg-white p-8 shadow-lg rounded-xl mt-10">
        <h2 class="text-2xl font-bold text-center mb-8 text-gray-800">Edit Address</h2>

        <form method="POST" action="/edit-address/<%= address._id %>" id="editAddressForm" class="space-y-6">

            <!-- Full Name -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
                <input 
                    type="text" 
                    name="fullname" 
                    value="<%= address.fullname %>" 
                    required 
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                    placeholder="John Doe"
                />
                <p class="error text-red-600 text-sm mt-1 hidden"></p>
            </div>

            <!-- Phone -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number *</label>
                <input 
                    type="tel" 
                    name="phone" 
                    maxlength="10" 
                    value="<%= address.phone %>" 
                    required 
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                    placeholder="9876543210"
                />
                <p class="error text-red-600 text-sm mt-1 hidden"></p>
            </div>

            <!-- Pincode & City side by side -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Pincode *</label>
                    <input 
                        type="text" 
                        name="pincode" 
                        maxlength="6" 
                        value="<%= address.pincode %>" 
                        required 
                        class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="400001"
                    />
                    <p class="error text-red-600 text-sm mt-1 hidden"></p>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">City / Town *</label>
                    <input 
                        type="text" 
                        name="city" 
                        value="<%= address.city %>" 
                        required 
                        class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                        placeholder="Mumbai"
                    />
                    <p class="error text-red-600 text-sm mt-1 hidden"></p>
                </div>
            </div>

            <!-- State -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">State *</label>
                <select 
                    name="state" 
                    required 
                    class="w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500"
                >
                    <option value="<%= address.state %>" selected><%= address.state %></option>
                    <option value="Andhra Pradesh">Andhra Pradesh</option>
                    <option value="Delhi">Delhi</option>
                    <option value="Karnataka">Karnataka</option>
                    <option value="Kerala">Kerala</option>
                    <option value="Maharashtra">Maharashtra</option>
                    <option value="Tamil Nadu">Tamil Nadu</option>
                    <option value="Telangana">Telangana</option>
                    <!-- Add remaining states if needed -->
                </select>
                <p class="error text-red-600 text-sm mt-1 hidden"></p>
            </div>

            <!-- Buttons -->
            <div class="flex gap-4 pt-6">
                <button 
                    type="submit" 
                    class="flex-1 bg-purple-600 text-white py-3 rounded-lg font-medium hover:bg-purple-700 transition"
                >
                    Update Address
                </button>
                <a 
                    href="/user-Profile" 
                    class="flex-1 border border-gray-400 text-gray-700 py-3 rounded-lg text-center font-medium hover:bg-gray-50 transition"
                >
                    Cancel
                </a>
            </div>

        </form>
    </div>

    <%- include("../../views/partials/user/footer") %>

    <script>
        const form = document.getElementById("editAddressForm");

        function showError(input, message) {
            const errorEl = input.parentElement.querySelector(".error");
            errorEl.textContent = message;
            errorEl.classList.remove("hidden");
            input.classList.add("border-red-500", "focus:border-red-500");
            input.classList.remove("border-green-500");
        }

        function clearError(input) {
            const errorEl = input.parentElement.querySelector(".error");
            errorEl.textContent = "";
            errorEl.classList.add("hidden");
            input.classList.remove("border-red-500");
            input.classList.add("border-green-500");
        }

        function validateField(field) {
            clearError(field);

            if (!field.value.trim() && field.required) {
                showError(field, "This field is required");
                return false;
            }

            if (field.name === "fullname") {
                if (field.value.trim().length < 3 || !/^[A-Za-z ]+$/.test(field.value.trim())) {
                    showError(field, "Only letters & spaces, minimum 3 characters");
                    return false;
                }
            }

            if (field.name === "phone") {
                if (!/^[6-9]\d{9}$/.test(field.value.trim())) {
                    showError(field, "Enter valid 10-digit Indian mobile number");
                    return false;
                }
            }

            if (field.name === "pincode") {
                if (!/^[1-9]\d{5}$/.test(field.value.trim())) {
                    showError(field, "Enter valid 6-digit Indian pincode");
                    return false;
                }
            }

            

            if (field.name === "city") {
                if (!/^[A-Za-z ]{2,}$/.test(field.value.trim())) {
                    showError(field, "Only letters and spaces, minimum 2 characters");
                    return false;
                }
            }

            if (field.name === "state") {
                if (!field.value) {
                    showError(field, "Please select a state");
                    return false;
                }
            }

            return true;
        }

        // Live validation on blur
        form.querySelectorAll("input, select").forEach(field => {
            field.addEventListener("blur", () => {
                validateField(field);
            });
        });

        // Form submit validation with SweetAlert2
        form.addEventListener("submit", (e) => {
            let isValid = true;

            form.querySelectorAll("input, select").forEach(field => {
                if (!validateField(field)) {
                    isValid = false;
                }
            });

            if (!isValid) {
                e.preventDefault();

                Swal.fire({
                    icon: 'warning',
                    title: 'Please fix the errors',
                    text: 'Check the fields marked in red and correct them before submitting.',
                    confirmButtonColor: '#8b5cf6', // purple-500
                    confirmButtonText: 'Got it',
                    toast: false,
                    position: 'center',
                    showConfirmButton: true
                });
            }
        });
    </script>
</body>
</html>