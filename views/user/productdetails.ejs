<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - <%= product.productName %></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="bg-gray-100 min-h-screen">

    <!-- Header -->
    <header class="bg-black text-white shadow-sm">
        <%- include("../../views/partials/user/header") -%>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-10">

        <!-- Breadcrumb -->
        <nav class="flex flex-wrap items-center text-sm text-gray-500 mb-6 gap-2">
            <a href="/" class="hover:text-gray-700 transition">Home</a>
            <span class="text-gray-400">/</span>
            <a href="/products-user" class="hover:text-gray-700 transition">Products</a>
            <span class="text-gray-400">/</span>
            <a href="/products-user?category=<%= category.categoryname %>" class="hover:text-gray-700 transition">
                <%= category.categoryname %>
            </a>
            <span class="text-gray-400">/</span>
            <span class="text-gray-700 font-medium truncate max-w-[180px] sm:max-w-none">
                <%= product.productName %>
            </span>
        </nav>

        <!-- Product Detail Section -->
        <div class="flex flex-col lg:flex-row gap-6 lg:gap-10 mb-12">

            <!-- Images Section -->
            <div class="w-full lg:w-1/2 flex flex-col gap-4">

                <!-- Main Image (with zoom effect) -->
                <div class="border border-gray-200 rounded-lg overflow-hidden bg-white relative cursor-zoom-in"
                     id="mainImageContainer">
                    <img id="mainProductImage"
                         src="<%= product.productImage[0]?.url %>"
                         alt="<%= product.productName %>"
                         class="w-full h-auto max-h-[500px] object-contain transition-transform duration-300">
                </div>

                <!-- Thumbnails -->
                <div class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 gap-2 sm:gap-3">
                    <% product.productImage.forEach((img, index) => { %>
                    <button class="thumbnail-btn aspect-square border border-gray-200 rounded-md overflow-hidden hover:border-blue-500 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-300 transition"
                            data-index="<%= index %>">
                        <img src="<%= img.url %>" alt="Thumbnail <%= index + 1 %>"
                             class="w-full h-full object-contain p-1">
                    </button>
                    <% }) %>
                </div>
            </div>

            <!-- Product Info -->
            <div class="w-full lg:w-1/2">

                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-3 leading-tight">
                    <%= product.productName %>
                </h1>

                <!-- Rating + Discount -->
                <div class="flex flex-wrap items-center gap-3 mb-4">
                    <div class="flex text-yellow-400">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span class="text-sm text-gray-600">(69 Reviews)</span>

                    <% if (product.discountPercent && product.discountPercent > 0) { %>
                    <span class="bg-orange-600 text-white text-xs font-bold px-3 py-1 rounded-full">
                        <%= product.discountPercent %>% OFF
                    </span>
                    <% } %>
                </div>

                <!-- Price -->
                <div class="flex items-baseline gap-3 mb-6">
                    <span class="text-3xl sm:text-4xl font-bold text-gray-900">
                        ₹<%= product.discountedPrice %>
                    </span>
                    <% if (product.originalPrice && product.originalPrice !== product.discountedPrice) { %>
                    <span class="text-lg text-gray-500 line-through">
                        ₹<%= product.originalPrice %>
                    </span>
                    <% } %>
                </div>

                <!-- Description -->
                <div class="prose prose-sm sm:prose text-gray-700 mb-8 max-w-none">
                    <p><%= product.description %></p>
                </div>

                <!-- Actions -->
                <div class="flex flex-col sm:flex-row gap-4 mb-8">
                    <% if (product.inCart) { %>
                    <a href="/cart"
                       class="flex-1 bg-green-600 hover:bg-green-700 text-white text-center py-3.5 rounded-lg font-semibold transition shadow-sm">
                        Go to Cart
                    </a>
                    <% } else { %>
                    <a href="/add-to-cart/<%= product._id %>"
                       class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-center py-3.5 rounded-lg font-semibold transition shadow-sm">
                        Add to Cart
                    </a>
                    <% } %>

                    <button onclick="toggleWishlist('<%= product._id %>')"
                            class="w-14 h-14 flex items-center justify-center rounded-lg border transition-all <%= product.inWishlist ? 'bg-red-50 border-red-400' : 'bg-white border-gray-300 hover:border-gray-400' %>">
                        <i class="<%= product.inWishlist ? 'fas' : 'far' %> fa-heart text-xl <%= product.inWishlist ? 'text-red-500' : 'text-gray-600' %>"></i>
                    </button>
                </div>

                <!-- Delivery Info -->
                <div class="border border-gray-200 rounded-lg divide-y">
                    <div class="p-4 flex items-start gap-4">
                        <i class="fas fa-truck text-gray-600 text-xl mt-1"></i>
                        <div>
                            <p class="font-medium">Free Delivery</p>
                            <p class="text-sm text-gray-600">Enter your postal code for delivery availability</p>
                        </div>
                    </div>
                    <div class="p-4 flex items-start gap-4">
                        <i class="fas fa-undo text-gray-600 text-xl mt-1"></i>
                        <div>
                            <p class="font-medium">Return Delivery</p>
                            <p class="text-sm text-gray-600">
                                Free 30 Days Delivery Returns. 
                                <a href="#" class="text-blue-600 hover:underline">Details</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <section class="mb-12">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <i class="fas fa-mobile-alt text-yellow-500"></i>
                Related Items
            </h2>
            <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5 sm:gap-6">
                <% relatedProducts.forEach(product => { %>
                <div class="group bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-200 relative flex flex-col">
                    <% if (product.discountPercent && product.discountPercent > 0) { %>
                    <div class="absolute top-3 left-3 z-10">
                        <span class="bg-orange-600 text-white text-xs font-bold px-2.5 py-1 rounded-full shadow-sm">
                            <%= product.discountPercent %>% OFF
                        </span>
                    </div>
                    <% } %>

                    <div class="absolute top-3 right-3 z-10">
                        <% if (product.inCart) { %>
                        <div class="bg-white/90 p-2.5 rounded-full shadow-md cursor-not-allowed">
                            <i class="fa-solid fa-heart text-gray-300 opacity-60 text-xl"></i>
                        </div>
                        <% } else { %>
                        <a href="/wishlist/toggle/<%= product._id %>"
                           class="bg-white p-2.5 rounded-full shadow-md hover:shadow-lg transition-all duration-300 active:scale-95">
                            <i class="fa-heart text-xl <%= product.inWishlist ? 'fa-solid text-red-500' : 'fa-regular text-gray-500 hover:text-red-400' %>"></i>
                        </a>
                        <% } %>
                    </div>

                    <div class="relative pt-[100%] sm:pt-[85%] bg-gray-50 overflow-hidden">
                        <img src="<%= product.productImage[0]?.url %>"
                             onclick="window.location.href='/productdetails/<%= product._id %>'"
                             class="absolute inset-0 w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-500 cursor-pointer" />
                    </div>

                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="font-semibold text-sm sm:text-base text-gray-800 line-clamp-2 min-h-[2.5rem] mb-2">
                            <%= product.productName %>
                        </h3>

                        <div class="flex items-center gap-2.5 mb-2">
                            <p class="text-purple-700 font-bold text-lg sm:text-xl">
                                ₹<%= product.discountedPrice %>
                            </p>
                            <% if (product.discountPercent && product.discountPercent > 0) { %>
                            <p class="text-gray-500 text-sm line-through">
                                ₹<%= product.originalPrice %>
                            </p>
                            <% } %>
                        </div>

                        <div class="flex items-center gap-1 mb-4">
                            <i class="fas fa-star text-yellow-400 text-sm"></i>
                            <span class="text-gray-500 text-xs">5</span>
                        </div>

                        <button class="toggle-cart-btn mt-auto w-full rounded-full py-2.5 font-medium text-white transition-all
                                       <%= product.inCart ? 'bg-green-600 hover:bg-green-700' : 'bg-purple-600 hover:bg-purple-700' %>"
                                data-product-id="<%= product._id %>"
                                data-in-cart="<%= product.inCart %>">
                            <i class="fas fa-shopping-cart text-sm mr-2"></i>
                            <span><%= product.inCart ? 'Go to Cart' : 'Add to Cart' %></span>
                        </button>
                    </div>
                </div>
                <% }) %>
            </div>
        </section>

        <!-- Product Details & Reviews (combined section for better mobile flow) -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">

            <!-- Specifications & Warranty -->
            <div>
                <h2 class="text-2xl font-bold mb-6">Product Details</h2>

                <div class="space-y-8">
                    <div>
                        <h3 class="font-semibold text-lg mb-4">General Specs</h3>
                        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-6 text-sm">
                            <dt class="text-gray-600">Model</dt>
                            <dd class="font-medium">P71B Pro</dd>
                            <dt class="text-gray-600">Connectivity</dt>
                            <dd class="font-medium">Bluetooth, WiFi</dd>
                            <dt class="text-gray-600">Compatible Devices</dt>
                            <dd class="font-medium">Mobile, Tablet</dd>
                        </dl>
                    </div>

                    <div>
                        <h3 class="font-semibold text-lg mb-4">Warranty</h3>
                        <dl class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-6 text-sm">
                            <dt class="text-gray-600">Domestic Warranty</dt>
                            <dd class="font-medium">1 Year</dd>
                            <dt class="text-gray-600">Warranty Summary</dt>
                            <dd class="font-medium">1 Year Warranty from the Date of Purchase</dd>
                            <dt class="text-gray-600">Warranty Service Type</dt>
                            <dd class="font-medium">Reach Out To us at info@mammbramelasupport.com</dd>
                            <dt class="text-gray-600">Covered in Warranty</dt>
                            <dd class="font-medium">Manufacturing Defects</dd>
                            <dt class="text-gray-600">Not Covered in Warranty</dt>
                            <dd class="font-medium">Physical damages</dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- Reviews -->
            <div>
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                    <h2 class="text-2xl font-bold">Reviews</h2>
                    <a href="#" class="text-blue-600 hover:underline flex items-center text-sm sm:text-base">
                        <i class="fas fa-pen-to-square mr-2"></i> Leave a review
                    </a>
                </div>

                <!-- Review Summary -->
                <div class="flex flex-col md:flex-row gap-6 mb-8">
                    <div class="flex flex-col items-center justify-center p-6 bg-white border border-gray-200 rounded-xl min-w-[180px]">
                        <div class="text-5xl font-bold mb-2">4.1</div>
                        <div class="flex text-yellow-400 text-2xl mb-2">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>
                        </div>
                        <span class="text-sm text-gray-600">65 reviews</span>
                    </div>

                    <div class="flex-1 space-y-3">
                        <div class="flex items-center gap-3">
                            <span class="w-10 text-right text-sm text-gray-600">5 ★</span>
                            <div class="flex-1 h-2.5 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full bg-yellow-400" style="width: 65%"></div>
                            </div>
                            <span class="w-8 text-sm text-gray-600 text-right">33</span>
                        </div>
                        <!-- Repeat for 4,3,2,1 stars with same structure -->
                        <!-- ... (kept same as your original) ... -->
                    </div>
                </div>

                <!-- Sample Reviews -->
                <div class="space-y-8">
                    <!-- Review items remain the same – just better spacing -->
                    <!-- Your existing review blocks here -->
                </div>

                <div class="text-center mt-8">
                    <a href="#" class="text-blue-600 hover:underline font-medium inline-flex items-center">
                        Show all reviews <i class="fas fa-chevron-right ml-2 text-sm"></i>
                    </a>
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-indigo-900 text-white mt-12">
        <%- include("../../views/partials/user/footer") -%>
    </footer>

    <!-- Scripts -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mainContainer = document.getElementById('mainImageContainer');
            const mainImage = document.getElementById('mainProductImage');
            const thumbnails = document.querySelectorAll('.thumbnail-btn');

            if (!mainContainer || !mainImage) return;

            // Zoom effect
            mainContainer.addEventListener('mouseenter', () => {
                mainImage.style.transition = 'transform 0.4s ease';
                mainImage.style.transform = 'scale(1.8)';
            });

            mainContainer.addEventListener('mousemove', (e) => {
                const rect = mainContainer.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                mainImage.style.transformOrigin = `${x}% ${y}%`;
            });

            mainContainer.addEventListener('mouseleave', () => {
                mainImage.style.transform = 'scale(1)';
            });

            // Thumbnail switching
            thumbnails.forEach(btn => {
                btn.addEventListener('click', () => {
                    const src = btn.querySelector('img').src;
                    mainImage.src = src;

                    // Optional: highlight active thumbnail
                    thumbnails.forEach(b => b.classList.remove('border-blue-500', 'ring-2', 'ring-blue-300'));
                    btn.classList.add('border-blue-500', 'ring-2', 'ring-blue-300');
                });
            });
        });

        // Your existing toggleWishlist function (assumed to be defined elsewhere or via partial)
        function toggleWishlist(productId) {
            // Your wishlist toggle logic here (fetch or redirect)
            console.log('Toggling wishlist for:', productId);
            // Example: window.location.href = `/wishlist/toggle/${productId}`;
        }
    </script>

</body>
</html>