<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Order Details</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 p-6">

  <h1 class="text-3xl font-bold mb-6">Order Details</h1>

  <div class="bg-white p-6 rounded shadow">
    <p><strong>Order ID:</strong>
      <%= order.orderId %>
    </p>

    <p><strong>Ordered At:</strong>
      <%= new Date(order.orderedAt).toLocaleDateString() %>
    </p>
    <p><strong>Delivered At:</strong>
      <%= order.deliveredAt ? new Date(order.deliveredAt).toLocaleDateString() : '-' %>
    </p>

      <div class="mt-2 flex flex-wrap gap-4 text-sm">

  <!-- Order Status -->
  <div class="flex items-center gap-2">
      <span class="font-semibold">Order Status:</span>
    <span class="px-3 py-1 rounded-full text-white
      <%= order.status === 'Delivered' ? 'bg-green-600' :
          order.status === 'Cancelled' ? 'bg-red-600' :
          order.status === 'Confirmed' ? 'bg-blue-600' :
          'bg-yellow-500' %>">
      <%= order.status %>
    </span>
  </div>

  <!-- Payment Status -->
  <div class="flex items-center gap-2">
    <span class="font-semibold">Payment Status:</span>
    <span class="px-3 py-1 rounded-full text-white
      <%= order.paymentStatus === 'Paid' ? 'bg-green-600' :
          order.paymentStatus === 'Failed' ? 'bg-red-600' :
          'bg-yellow-500' %>">
      <%= order.paymentStatus %>
    </span>
  </div>

  <!-- Payment Method -->
  <div class="flex items-center gap-2">
    <span class="font-semibold">Payment Method:</span>
    <span class="px-3 py-1 rounded-full bg-gray-800 text-white">
      <%= order.paymentMethod %>
    </span>
  </div>

</div>




    <!-- Entire Order Actions -->
    <div class="mt-4 flex gap-4">
      <% if(order.status !=='Delivered' && order.status !=='Cancelled' ) { %>
        <form action="/order/cancel/<%= order._id %>" method="POST">
          <button type="button" onclick="openReasonModal('/order/cancel/<%= order._id %>', 'Cancel Entire Order')"
            class="px-4 py-2 bg-red-600 text-white rounded">
            Cancel Entire Order
          </button>

        </form>
        <% } %>
    </div>

    <table class="min-w-full mt-6 border">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 border">Product</th>
          <th class="p-2 border">Qty</th>
          <th class="p-2 border">Price</th>
          <th class="p-2 border">Status</th>
          <th class="p-2 border">Action</th>
        </tr>
      </thead>
      <tbody>
        <% order.items.forEach(item=> { %>
          <tr class="border-b">
            <td class="p-2 border flex items-center gap-2">
              <img src="<%= item.image %>" class="w-12 h-12 object-cover rounded">
              <%= item.name %>
            </td>
            <td class="p-2 border">
              <%= item.qty %>
            </td>
            <td class="p-2 border">₹<%= item.finalPrice %>
            </td>
            <td class="p-2 border">
              <%= item.status || order.status %>
            </td>
            <td class="p-2 border flex gap-2">
              <% if(item.status !=='Delivered' && order.status !=='Cancelled' ) { %>
                <form action="/order/cancel-item/<%= order._id %>/<%= item._id %>" method="POST">
                  <% if(item.status !=="Cancelled" ){ %>
                    <button type="button"
                      onclick="openReasonModal('/order/cancel-item/<%= order._id %>/<%= item._id %>', 'Cancel Product')"
                      class="px-2 py-1 bg-red-500 text-white rounded text-xs">
                      Cancel
                    </button>
                    <% } %>
                </form>
                <% } %>
                  <% if(item.status==='Delivered' && order.status !=='Returned' ) { %>
                    <form action="/order/return-item/<%= order._id %>/<%= item._id %>" method="POST">
                      <button type="button" 
                      onclick="openReasonModal('/order/return-item/<%= order._id %>/<%= item._id %>','Return Product' )" class="px-2 py-1 bg-yellow-500 text-white rounded text-xs">
                        Return
                      </button>

                    </form>
                    <% } %>
            </td>
          </tr>
          <% }) %>
      </tbody>
    </table>

        <hr class="my-4">

<h2 class="text-xl font-semibold mb-2">Payment Summary</h2>

<div class="space-y-1 text-sm">
  <p class="flex justify-between">
    <span>Subtotal</span>
    <span>₹<%= order.subtotalAmount %></span>
  </p>

  <% if(order.coupon && order.coupon.discountAmount > 0){ %>
    <p class="flex justify-between text-green-600">
      <span>
        Coupon Applied (<%= order.coupon.code %>)
      </span>
      <span>- ₹<%= order.coupon.discountAmount %></span>
    </p>
  <% } else { %>
    <p class="flex justify-between text-gray-500">
      <span>No Coupon Applied</span>
      <span>₹0</span>
    </p>
  <% } %>

  <hr>

  <p class="flex justify-between font-bold text-lg">
    <span>Total Paid</span>
    <span>₹<%= order.totalAmount %></span>
  </p>
</div>
  </div>

  

  <!-- Reason Modal -->
  <div id="reasonModal" class="fixed inset-0 bg-black bg-opacity-40 hidden justify-center items-center">
    <div class="bg-white p-6 rounded w-96">
      <h2 id="modalTitle" class="text-xl font-bold mb-4"></h2>

      <form id="reasonForm" method="POST">
        <textarea name="reason" required class="w-full p-2 border rounded" placeholder="Enter reason..."></textarea>

        <div class="mt-4 flex justify-end gap-2">
          <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-400 text-white rounded">Close</button>
          <button class="px-4 py-2 bg-blue-600 text-white rounded">Submit</button>
        </div>
      </form>
    </div>
  </div>


</body>
<script>

  function openReasonModal(actionUrl, title) {
    document.getElementById("reasonForm").action = actionUrl;
    document.getElementById("modalTitle").innerText = title;
    document.getElementById("reasonModal").classList.remove("hidden");
  }

  function closeModal() {
    document.getElementById("reasonModal").classList.add("hidden");
  }


</script>

</html>